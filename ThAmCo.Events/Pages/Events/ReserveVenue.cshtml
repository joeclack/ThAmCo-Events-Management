@page
@using Microsoft.AspNetCore.Authorization;
@using Microsoft.AspNetCore.Mvc.RazorPages;

@attribute [Authorize]
@model ThAmCo.Events.Pages.Events.ReserveVenueModel
@{
}
<div class="page-container">
	<header class="header">
		<h1>Start by reserving a venue</h1>
	</header>

	<div class="card">
		<form method="post" asp-page-handler="SearchVenues">
			<div class="form-group">
				<div class="form-group">
					<label for="eventType" class="required">Event Type:</label>
					<select class="form-select" asp-for="SelectedEventType" required>
						<option value="">Select Event Type</option>
						@foreach (var type in Model.EventTypes)
						{
							<option value="@type.Id">@type.Title</option>
						}
					</select>
				</div>
				<div class="form-group">
					<label for="startDate" class="required">From:</label>
					<input type="date" id="startDate" name="startDate" class="form-select"
						   value="@Model.StartDate.ToString("yyyy-MM-dd")" required
						   min="@DateTime.Today.ToString("yyyy-MM-dd")" />
				</div>
				<div class="form-group">
					<label for="endDate" class="required">To:</label>
					<input type="date" id="endDate" name="endDate" class="form-select"
						   value="@Model.EndDate.ToString("yyyy-MM-dd")" required
						   min="@DateTime.Today.ToString("yyyy-MM-dd")" />
				</div>
				<div class="form-group">
					<button type="submit" class="btn-create">
						Search Available Venues
					</button>
				</div>
			</div>
		</form>
	</div>

	<div class="row mt-1">
		<div class="card full-width">
			<div class="create-total-header">
				<h2>Available Venues</h2>
				<span class="count-span">Total: @Model.AvailableVenues?.Count</span>
			</div>
			@if (Model.AvailableVenues?.Any() == true)
			{
				<div class="scrollable-content">
					<table class="table">
						<thead>
							<tr>
								<th>Name</th>
								<th>Description</th>
								<th>Date</th>
								<th>Capacity</th>
								<th>Cost/Hour</th>
								<th class="action-group-column">Actions</th>
							</tr>
						</thead>
						<tbody>
							@foreach (var venue in Model.AvailableVenues)
							{
								<tr>
									<td>@venue.Name</td>
									<td>@venue.Description</td>
									<td>@venue.Date.ToString("dd MMM yyyy")</td>
									<td>@venue.Capacity</td>
									<td>@venue.CostPerHour.ToString("C")</td>
									<td>
										<a asp-page="Events/Create" asp-route-eventType="@Model.SelectedEventType"
										   asp-route-code="@venue.Code"
										   asp-route-date="@venue.Date" class="btn-create">Reserve</a>
									</td>
								</tr>
							}
						</tbody>
					</table>
				</div>
			}
			else
			{
				<div class="alert warning-alert">
					No venues available for the selected criteria. Try different dates or event type.
				</div>
			}
		</div>
	</div>
</div>


<script>
	document.addEventListener('DOMContentLoaded', function() {
		const startDate = document.getElementById('startDate');
		const endDate = document.getElementById('endDate');

		startDate.addEventListener('change', function() {
			endDate.min = this.value;
			if (endDate.value && endDate.value < this.value) {
				endDate.value = this.value;
			}
		});

		endDate.addEventListener('change', function() {
			if (startDate.value && this.value < startDate.value) {
				this.value = startDate.value;
			}
		});
	});
</script>